<!DOCTYPE html>
<html>
<head>
  <title>Add Event</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      animation: fadeIn 1s ease-in-out;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      width: 350px;
      animation: slideUp 0.7s ease-out;
    }

    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      color: #555;
      display: block;
      margin-top: 10px;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #ccc;
      border-radius: 8px;
      margin-top: 5px;
      font-size: 14px;
      transition: 0.3s;
    }

    input:focus, textarea:focus {
      border-color: #6a11cb;
      outline: none;
      box-shadow: 0 0 8px rgba(106,17,203,0.3);
    }

    button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Create Event</h2>

  <label>Title:</label>
  <input type="text" id="eventTitle">

  <label>Description:</label>
  <textarea id="eventDesc"></textarea>

  <label>End Date/Time:</label>
  <input type="datetime-local" id="eventEnd">

  <button id="saveEvent">Save Event</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyAjeXycCBhYoAU-0iiC4LbSTylKrrThN8Y",
    authDomain: "sharplabubu.firebaseapp.com",
    databaseURL: "https://sharplabubu-default-rtdb.firebaseio.com",
    projectId: "sharplabubu",
    storageBucket: "sharplabubu.firebasestorage.app",
    messagingSenderId: "596148393481",
    appId: "1:596148393481:web:4f822d86c44a13bd810ad8",
    measurementId: "G-4M25R3BF08"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Discord webhook URL
const eventWebhookURL = "https://discordapp.com/api/webhooks/1404625886329962678/m1bgTkbRRPY68k3Zl85MhkSYLsXv5GSoGEdU-FCb5IYT_N2DS6g03xopIR89yWTmAroC"; 

// Function to send a webhook message
async function sendEventWebhook(title, description, end) {
    const webhookMessage = {
        content: `@everyone ðŸŽ‰ **New Event: ${title}** ðŸŽ‰\n`
               + `**Description:** ${description}\n`
               + `**Ends:** <t:${Math.floor(new Date(end).getTime() / 1000)}:F>`,
        allowed_mentions: {
            parse: ["everyone"]
        }
    };

    try {
        const response = await fetch(eventWebhookURL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(webhookMessage)
        });
        if (!response.ok) {
            console.error("Failed to send new event webhook.");
        }
    } catch (error) {
        console.error("Error sending webhook:", error);
    }
}

document.getElementById("saveEvent").onclick = async () => {
    const title = document.getElementById("eventTitle").value.trim();
    const description = document.getElementById("eventDesc").value.trim();
    const end = document.getElementById("eventEnd").value;

    if (!title || !description || !end) {
        alert("Please fill out all fields.");
        return;
    }

    const endTime = new Date(end).getTime();
    if (isNaN(endTime) || endTime <= Date.now()) {
        alert("Please choose a future date/time.");
        return;
    }

    const newEventRef = push(ref(db, "events"));
    await set(newEventRef, {
        title,
        description,
        endTime
    });

    // Send Discord ping
    await sendEventWebhook(title, description, end);

    alert("Event created!");
    window.location.href = "index.html"; 
};
</script>
</body>
</html>
